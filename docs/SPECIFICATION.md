# miroyo - 仕様書

## 概要

ユーザーが日・週・月単位でがんばった成果を「見せびらかす」ためのWebアプリ。
DJで金のブリンブリンのネックレスをしたヒゲのお兄さんが、ニッコリしながら成果を紹介してくれる。

## コンセプト

- 自分の頑張りを気軽に記録し、他人にシェアして見せびらかせる
- 堅苦しくない、楽しい雰囲気で成果を振り返れる

## 機能一覧

### 1. 成果の報告

- ユーザーは自由入力のテキストで成果を報告する
  - 例：「今週毎日5km走った」「3日間で本を2冊読んだ」「1ヶ月で体重3kg減った」
- 入力されたテキストはGemini APIによって解釈され、以下の情報が抽出される
  - 期間（日・週・月）※入力内容から自動判定
  - がんばりの内容（運動、読書、学習など）
  - 数値データ（距離、回数、量など）
  - DJのお兄さんが紹介するセリフ
- 複数ジャンルの成果も1つの報告としてまとめて扱える
  - 例：「ジョギングと読書を頑張った」→ 1つの成果として解釈

### 2. 結果プレビュー・編集

- Gemini APIの解釈結果がプレビュー画面に表示される
- ユーザーはプレビュー画面で内容を確認し、再編集できる
  - テキストを修正して再度AIに解釈させることが可能
- 内容に納得したら「シェア」を押してシェア用URLを生成する

### 3. 結果画面（シェア画面）

- DJのお兄さんの画像が表示される
- DJのお兄さんが成果を紹介するセリフが表示される
- 数値データがグラフやカレンダー的なビジュアルで表示される
- 1回の報告単位で1つの結果画面が生成される

### 4. シェア機能

- 確定した成果はURLとしてシェアできる
- データはURLに直接埋め込む（Base64エンコードしたJSON）
  - DBを使用しない
  - URLを知っている人だけがアクセスできる
- シェアされたURLを開いた人は閲覧専用モードで結果画面を見る

## ユーザーフロー

```
1. トップページにアクセス
2. テキストで成果を入力
3. 「見せびらかす」ボタンを押す
4. Gemini APIがテキストを解釈
5. プレビュー画面で結果を確認
   - 修正したい場合 → テキストを編集して再解釈（手順4に戻る）
   - OKの場合 → 「確定」ボタンを押す
6. シェア用URLが生成される
7. URLをコピーして他人にシェア
```

```
シェアされたURLを開いた人：
1. URLにアクセス
2. 閲覧専用の結果画面が表示される
   - DJのお兄さんの画像
   - 紹介セリフ
   - グラフ・カレンダー等のビジュアル
```

## 技術構成

### フロントエンド

- HTML + JavaScript（フレームワークなし）
- Vercelで静的ホスティング
- グラフ描画ライブラリ（Chart.js等）を使用

### バックエンド

- Vercel Serverless Functions（Node.js）
- 役割：Gemini APIへのプロキシ（APIキーの秘匿）
- エンドポイント：`POST /api/interpret`

### データ管理

- DB不使用
- 成果データはJSON形式でBase64エンコードし、URLのハッシュフラグメントに埋め込む
  - 例：`https://miroyo.vercel.app/result#eyJjb250ZW50Ijoi...`
- ブラウザ側で完結するため、サーバー側にユーザーデータは保持しない

### AI連携

- Google Gemini API を使用（無料枠）
- テキスト入力から以下を抽出・生成する：
  - 期間の判定（日/週/月）
  - がんばりの内容の分類
  - 数値データの抽出
  - DJのお兄さんの紹介セリフ生成

## 画面構成

| 画面 | パス | 説明 |
|---|---|---|
| トップページ | `/` | 成果入力フォーム |
| プレビュー | `/preview` | AI解釈結果の確認・編集 |
| 結果画面 | `/result#<data>` | DJのお兄さんによる成果紹介（シェア先はこの画面） |

## 素材

| 素材 | 担当 | 備考 |
|---|---|---|
| DJのお兄さん画像 | スレ主が用意 | 固定画像 |

## 制約・注意事項

- URLの長さ制限：ブラウザによるが概ね2000文字程度が安全圏
  - 成果データが大きすぎるとURLが長くなりすぎる可能性がある
  - 必要に応じてデータの圧縮（pako等）を検討
- Gemini APIキーはサーバーサイド（Vercel環境変数）で管理し、フロントエンドには露出させない
- ユーザー認証なし（匿名利用）
- Gemini API無料枠の上限に達した場合、「現在サービスを利用できません」画面を表示する
  - バックエンドがAPI制限エラー（429等）を受け取った場合にフロントに通知
  - ユーザーには時間を置いて再度試すよう案内する
